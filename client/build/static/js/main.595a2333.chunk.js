(this["webpackJsonpreact-paint"]=this["webpackJsonpreact-paint"]||[]).push([[0],{25:function(t,e,s){},44:function(t,e,s){},63:function(t,e,s){},69:function(t,e,s){"use strict";s.r(e);var i=s(2),n=s(0),a=s(17),o=s.n(a),c=(s(44),s(25),s(8)),r=s(9),h=s(16),l=new(function(){function t(){Object(c.a)(this,t),this.tool=null,Object(h.c)(this)}return Object(r.a)(t,[{key:"setTool",value:function(t){this.tool=t}},{key:"setFillColor",value:function(t){this.tool.fillColor=t}},{key:"setStrokeColor",value:function(t){this.tool.strokeColor=t}},{key:"setLineWidth",value:function(t){this.tool.lineWidth=t}}]),t}()),u=function(){return Object(i.jsxs)("div",{className:"setting-bar",children:[Object(i.jsx)("label",{htmlFor:"line-width",children:"\u0422\u043e\u043b\u0449\u0438\u043d\u0430 \u043b\u0438\u043d\u0438\u0438"}),Object(i.jsx)("input",{id:"line-width",type:"number",defaultValue:1,min:1,max:50,onChange:function(t){return l.setLineWidth(t.target.value)},style:{margin:"0 10px"}}),Object(i.jsx)("label",{htmlFor:"stroke-color",children:"\u0426\u0432\u0435\u0442 \u043e\u0431\u0432\u043e\u0434\u043a\u0438"}),Object(i.jsx)("input",{id:"stroke-color",type:"color",onChange:function(t){return l.setStrokeColor(t.target.value)}})]})},d=s(15),f=s(14),v=function(){function t(e,s,i){Object(c.a)(this,t),this.canvas=e,this.socket=s,this.id=i,this.ctx=e.getContext("2d"),this.destroyEvents()}return Object(r.a)(t,[{key:"destroyEvents",value:function(){this.canvas.onmousemove=null,this.canvas.onmousedown=null,this.canvas.onmouseup=null}},{key:"fillColor",set:function(t){this.ctx.fillStyle=t}},{key:"strokeColor",set:function(t){this.ctx.strokeStyle=t}},{key:"lineWidth",set:function(t){this.ctx.lineWidth=t}}]),t}(),g=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,i,n){var a;return Object(c.a)(this,s),(a=e.call(this,t,i,n)).listen(),a}return Object(r.a)(s,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"finish"}})),this.ctx.beginPath()}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.ctx.moveTo(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&(this.draw(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop),this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"brush",x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop,lineWidth:this.ctx.lineWidth,strokeColor:this.ctx.strokeStyle}})))}},{key:"draw",value:function(t,e){this.ctx.lineTo(t,e),this.ctx.stroke()}}],[{key:"staticDraw",value:function(t,e,s,i,n){var a=t.lineWidth,o=t.strokeStyle;t.lineWidth=i,t.strokeStyle=n,t.lineTo(e,s),t.stroke(),t.lineWidth=a,t.strokeStyle=o}}]),s}(v),b=s(18),m=s.n(b),k={HOST:"https://mihail-react-paint.herokuapp.com",WS_HOST:"wss://mihail-react-paint.herokuapp.com"},y=new(function(){function t(){Object(c.a)(this,t),this.canvas=null,this.socket=null,this.sessionid=null,this.undoList=[],this.redoList=[],this.username="",Object(h.c)(this)}return Object(r.a)(t,[{key:"setUsername",value:function(t){this.username=t}},{key:"setSessionId",value:function(t){this.sessionid=t}},{key:"setSocket",value:function(t){this.socket=t}},{key:"setCanvas",value:function(t){this.canvas=t}},{key:"pushToUndo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.undoList.push(t),e||this.socket.send(JSON.stringify({method:"pushToUndo",id:this.sessionid}))}},{key:"pushToRedo",value:function(t){this.redoList.push(t)}},{key:"undo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||this.socket.send(JSON.stringify({method:"undo",id:this.sessionid}));var s=this.canvas.getContext("2d");if(this.undoList.length>0){var i=this.undoList.pop();this.redoList.push(this.canvas.toDataURL());var n=new Image;n.src=i,n.onload=function(){s.clearRect(0,0,t.canvas.width,t.canvas.height),s.drawImage(n,0,0,t.canvas.width,t.canvas.height),m.a.post("".concat(k.HOST,"/image?id=").concat(t.sessionid),{img:t.canvas.toDataURL()})}}}},{key:"redo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||this.socket.send(JSON.stringify({method:"redo",id:this.sessionid}));var s=this.canvas.getContext("2d");if(this.redoList.length>0){var i=this.redoList.pop();this.undoList.push(this.canvas.toDataURL());var n=new Image;n.src=i,n.onload=function(){s.clearRect(0,0,t.canvas.width,t.canvas.height),s.drawImage(n,0,0,t.canvas.width,t.canvas.height),m.a.post("".concat(k.HOST,"/image?id=").concat(t.sessionid),{img:t.canvas.toDataURL()})}}}}]),t}()),p=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,i,n){var a;return Object(c.a)(this,s),(a=e.call(this,t,i,n)).listen(),a}return Object(r.a)(s,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"rect",x:this.startX,y:this.startY,width:this.width,height:this.height,color:this.ctx.fillStyle,lineWidth:this.ctx.lineWidth,strokeColor:this.ctx.strokeStyle}})),this.ctx.beginPath()}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHandler",value:function(t){if(this.mouseDown){var e=t.pageX-t.target.offsetLeft,s=t.pageY-t.target.offsetTop;this.width=e-this.startX,this.height=s-this.startY,this.draw(this.startX,this.startY,this.width,this.height)}}},{key:"draw",value:function(t,e,s,i){var n=this,a=new Image;a.src=this.saved,a.onload=function(){n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height),n.ctx.drawImage(a,0,0,n.canvas.width,n.canvas.height),n.ctx.beginPath(),n.ctx.rect(t,e,s,i),n.ctx.fill(),n.ctx.stroke()}}}],[{key:"staticDraw",value:function(t,e,s,i,n,a,o,c){var r=t.fillStyle,h=t.lineWidth,l=t.strokeStyle;t.fillStyle=a,t.lineWidth=o,t.strokeStyle=c,t.beginPath(),t.rect(e,s,i,n),t.fill(),t.stroke(),t.beginPath(),t.fillStyle=r,t.lineWidth=h,t.strokeStyle=l}}]),s}(v),w=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,i,n){var a;return Object(c.a)(this,s),(a=e.call(this,t,i,n)).listen(),a}return Object(r.a)(s,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"circle",x:this.startX,y:this.startY,r:this.r,color:this.ctx.fillStyle,lineWidth:this.ctx.lineWidth,strokeColor:this.ctx.strokeStyle}})),this.ctx.beginPath()}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHandler",value:function(t){if(this.mouseDown){var e=t.pageX-t.target.offsetLeft,s=t.pageY-t.target.offsetTop,i=e-this.startX,n=s-this.startY;this.r=Math.sqrt(Math.pow(i,2)+Math.pow(n,2)),this.draw(this.startX,this.startY,this.r)}}},{key:"draw",value:function(t,e,s){var i=this,n=new Image;n.src=this.saved,n.onload=function(){i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),i.ctx.drawImage(n,0,0,i.canvas.width,i.canvas.height),i.ctx.beginPath(),i.ctx.arc(t,e,s,0,2*Math.PI),i.ctx.fill(),i.ctx.stroke()}}}],[{key:"staticDraw",value:function(t,e,s,i,n,a,o){var c=t.fillStyle,r=t.lineWidth,h=t.strokeStyle;t.fillStyle=n,t.lineWidth=a,t.strokeStyle=o,t.beginPath(),t.arc(e,s,i,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.fillStyle=c,t.lineWidth=r,t.strokeStyle=h}}]),s}(v),j=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,i,n){var a;return Object(c.a)(this,s),(a=e.call(this,t,i,n)).listen(),a.name="Line",a}return Object(r.a)(s,[{key:"listen",value:function(){this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this),this.canvas.onmousemove=this.mouseMoveHandler.bind(this)}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.currentX=t.pageX-t.target.offsetLeft,this.currentY=t.pageY-t.target.offsetTop,this.ctx.beginPath(),this.ctx.moveTo(this.currentX,this.currentY),this.saved=this.canvas.toDataURL()}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"line",startX:this.currentX,startY:this.currentY,endX:t.pageX-t.target.offsetLeft,endY:t.pageY-t.target.offsetTop,lineWidth:this.ctx.lineWidth,strokeColor:this.ctx.strokeStyle}})),this.ctx.beginPath()}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&this.draw(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"draw",value:function(t,e){var s=this,i=new Image;i.src=this.saved,i.onload=function(){s.ctx.clearRect(0,0,s.canvas.width,s.canvas.height),s.ctx.drawImage(i,0,0,s.canvas.width,s.canvas.height),s.ctx.beginPath(),s.ctx.moveTo(s.currentX,s.currentY),s.ctx.lineTo(t,e),s.ctx.stroke()}}}],[{key:"staticDraw",value:function(t,e,s,i,n,a,o){var c=t.lineWidth,r=t.strokeStyle;t.lineWidth=a,t.strokeStyle=o,t.beginPath(),t.moveTo(e,s),t.lineTo(i,n),t.stroke(),t.beginPath(),t.lineWidth=c,t.strokeStyle=r}}]),s}(v),x=function(t){Object(d.a)(s,t);var e=Object(f.a)(s);function s(t,i,n){var a;return Object(c.a)(this,s),(a=e.call(this,t,i,n)).listen(),a}return Object(r.a)(s,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"finish"}})),this.ctx.beginPath()}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.ctx.moveTo(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&(this.draw(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop),this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"eraser",x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop,lineWidth:this.ctx.lineWidth}})))}},{key:"draw",value:function(t,e){var s=this.ctx.strokeStyle;this.ctx.strokeStyle="white",this.ctx.lineTo(t,e),this.ctx.stroke(),this.ctx.strokeStyle=s}}],[{key:"staticDraw",value:function(t,e,s,i){var n=t.lineWidth,a=t.strokeStyle;t.lineWidth=i,t.strokeStyle="white",t.lineTo(e,s),t.stroke(),t.lineWidth=n,t.strokeStyle=a}}]),s}(v),O=function(){return Object(i.jsxs)("div",{className:"toolbar",children:[Object(i.jsx)("button",{className:"toolbar__btn brush",onClick:function(){return l.setTool(new g(y.canvas,y.socket,y.sessionid))}}),Object(i.jsx)("button",{className:"toolbar__btn rect",onClick:function(){return l.setTool(new p(y.canvas,y.socket,y.sessionid))}}),Object(i.jsx)("button",{className:"toolbar__btn circle",onClick:function(){return l.setTool(new w(y.canvas,y.socket,y.sessionid))}}),Object(i.jsx)("button",{className:"toolbar__btn eraser",onClick:function(){return l.setTool(new x(y.canvas,y.socket,y.sessionid))}}),Object(i.jsx)("button",{className:"toolbar__btn line",onClick:function(){return l.setTool(new j(y.canvas,y.socket,y.sessionid))}}),Object(i.jsx)("input",{type:"color",onChange:function(t){return function(t){l.setFillColor(t.target.value)}(t)},style:{marginLeft:10}}),Object(i.jsx)("button",{className:"toolbar__btn undo",onClick:function(){return y.undo()}}),Object(i.jsx)("button",{className:"toolbar__btn redo",onClick:function(){return y.redo()}}),Object(i.jsx)("button",{className:"toolbar__btn save",onClick:function(){return function(){var t=y.canvas.toDataURL(),e=document.createElement("a");e.href=t,e.download=y.sessionid+".jpg",document.body.appendChild(e),e.click(),document.body.removeChild(e)}()}})]})},S=s(37),D=(s(63),s(72)),T=s(19),H=s(38),L=s(5),W=s.p+"static/media/preview.aed74de5.gif",C=Object(D.a)((function(){var t=Object(n.useState)(!0),e=Object(S.a)(t,2),s=e[0],a=e[1],o=Object(n.useRef)(),c=Object(n.useRef)(),r=Object(L.g)();Object(n.useEffect)((function(){if(y.username){y.setCanvas(c.current);var t=c.current.getContext("2d");m.a.get("".concat(k.HOST,"/image?id=").concat(r.id)).then((function(e){var s=new Image;s.src=e.data,s.onload=function(){t.clearRect(0,0,c.current.width,c.current.height),t.drawImage(s,0,0,c.current.width,c.current.height)}}));var e=new WebSocket(k.WS_HOST);y.setSocket(e),y.setSessionId(r.id),l.setTool(new g(c.current,e,r.id)),e.onopen=function(){e.send(JSON.stringify({id:r.id,username:y.username,method:"connection"})),setInterval((function(){e.send(JSON.stringify({method:"DO_NOT_SLEEP"}))}),2e4)},e.onmessage=function(t){var e=JSON.parse(t.data);switch(e.method){case"connection":break;case"draw":h(e);break;case"undo":y.undo(!0);break;case"redo":y.redo(!0);break;case"pushToUndo":y.pushToUndo(c.current.toDataURL(),!0)}}}}),[y.username]);var h=function(t){var e=t.figure,s=c.current.getContext("2d");switch(e.type){case"brush":g.staticDraw(s,e.x,e.y,e.lineWidth,e.strokeColor);break;case"eraser":x.staticDraw(s,e.x,e.y,e.lineWidth);break;case"rect":p.staticDraw(s,e.x,e.y,e.width,e.height,e.color,e.lineWidth,e.strokeColor);break;case"circle":w.staticDraw(s,e.x,e.y,e.r,e.color,e.lineWidth,e.strokeColor);break;case"line":j.staticDraw(s,e.startX,e.startY,e.endX,e.endY,e.lineWidth,e.strokeColor);break;case"finish":s.beginPath()}};return Object(i.jsxs)("div",{className:"canvas",children:[Object(i.jsxs)(T.a,{show:s,onHide:function(){},children:[Object(i.jsx)("h1",{style:{margin:20},children:"\u041f\u0420\u041e\u0421\u0422\u041e \u041f\u041e\u0414\u0415\u041b\u0418\u0421\u042c \u0421\u0421\u042b\u041b\u041a\u041e\u0419 \u0421 \u0414\u0420\u0423\u0413\u041e\u041c!"}),Object(i.jsx)("div",{children:Object(i.jsx)("img",{className:"gif",src:W})}),Object(i.jsx)(T.a.Header,{children:Object(i.jsx)(T.a.Title,{children:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0438\u043c\u044f"})}),Object(i.jsx)(T.a.Body,{children:Object(i.jsx)("input",{required:!0,type:"text",ref:o})}),Object(i.jsx)(T.a.Footer,{children:Object(i.jsx)(H.a,{variant:"primary",onClick:function(){0!==o.current.value.length&&(y.setUsername(o.current.value),a(!1))},children:"\u0412\u043e\u0439\u0442\u0438"})})]}),Object(i.jsx)("canvas",{onMouseUp:function(){m.a.post("".concat(k.HOST,"/image?id=").concat(r.id),{img:c.current.toDataURL()})},onMouseDown:function(){y.pushToUndo(c.current.toDataURL())},ref:c,width:600,height:400})]})})),U=s(22);var X=function(){return Object(i.jsx)(U.a,{children:Object(i.jsx)("div",{className:"app",children:Object(i.jsxs)(L.d,{children:[Object(i.jsxs)(L.b,{path:"/:id",children:[Object(i.jsx)(O,{}),Object(i.jsx)(u,{}),Object(i.jsx)(C,{})]}),Object(i.jsx)(L.a,{to:"f".concat((+new Date).toString(16))})]})})})};o.a.render(Object(i.jsx)(X,{}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.595a2333.chunk.js.map